<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Podcast Learning App</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.1/lucide-react.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUG9kY2FzdCBMZWFybmluZyBBcHAiLCJzaG9ydF9uYW1lIjoiUG9kY2FzdCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjMjU2M2ViIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TkNBeU5DSWdhR1ZwWjJoMFBTSXlOQ0lnZDJsa2RHZzlJakl3SWlCbWFXeHNQU0lqTWpVMk0yVmlJaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpUGlBZ1BIQmhkR2dnWkQwaWJURXdJREZzTkNBeExUTnNMVEVnTVRBdE1URXlkakV3YkRReUxURXVOVFF0TVM0MU5DMDJMakUyTFRFMGJESTFMU0V5WkNJdlBpQWdQQzl6ZG1jKyIsInNpemVzIjoiMjR4MjQiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <meta name="theme-color" content="#2563eb">
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .container { max-width: 28rem; margin: 0 auto; background: white; min-height: 100vh; }
        .error-message { padding: 20px; text-align: center; color: red; }
    </style>
    <script>
        // Check browser compatibility
        if (!window.fetch) {
            document.write('<div class="error-message"><h2>Browser Not Supported</h2><p>Please use a modern browser like Chrome, Safari, or Firefox.</p></div>');
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;
        const { Play, Pause, Square, Loader, Send, MessageSquare, BookOpen, Headphones } = lucideReact;

        const PodcastLearningApp = () => {
            const [topic, setTopic] = useState('');
            const [clarifyingQuestions, setClarifyingQuestions] = useState([]);
            const [answers, setAnswers] = useState({});
            const [currentAnswer, setCurrentAnswer] = useState('');
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [report, setReport] = useState('');
            const [isResearching, setIsResearching] = useState(false);
            const [isGeneratingQuestions, setIsGeneratingQuestions] = useState(false);
            const [stage, setStage] = useState('input');
            const [isPlaying, setIsPlaying] = useState(false);
            const [isPaused, setIsPaused] = useState(false);
            const [error, setError] = useState('');
            const speechSynthRef = useRef(null);

            const RESEARCH_PROMPT = `provide an in-depth research report on [TOPIC]. include detailed insights on: [SUBTOPICS]. i'm not aiming for expert level understanding, but rather to form my own point of view and be able to confidently discuss this topic with people who are experts. structure it with an executive summary, then detailed sections with clear headings (you can come up with the sections that make sense based on the topic). include relevant examples, case studies, and data to support key points and recommendations. if the topic is complex and requires in-depth understanding of a specific technology, use analogies to explain concepts. if there is debate on the topic, i want to see both points of view. always cite your resources. this is for someone who has worked in tech for the last 10 years and is somewhat familiar with latest developments, interested in social psychology and behavioral economics, business management, business strategy, and leadership skills. i will use this report to continue to expand my knowledge so i can always be informed with the latest trends and developments at work and to become a better business leader.`;

            const generateClarifyingQuestions = async () => {
                if (!topic.trim()) return;
                
                setIsGeneratingQuestions(true);
                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [
                                {
                                    role: "user",
                                    content: `I want to research the topic: "${topic}"

Before conducting research, I need you to ask me clarifying questions to fill in any information gaps. Consider that this is for someone who has worked in tech for 10 years, is interested in social psychology, behavioral economics, business management, strategy, and leadership.

Please generate 3-5 specific clarifying questions that would help you provide the most relevant and valuable research report. Focus on:
- Specific aspects or angles they want to explore
- Context or application they're most interested in
- Any particular industry focus or use cases
- Current level of familiarity with the topic

Respond with ONLY a JSON array of question strings, like this:
["Question 1?", "Question 2?", "Question 3?"]

Do not include any other text or formatting.`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    let questionsText = data.content[0].text.trim();
                    
                    questionsText = questionsText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    
                    const questions = JSON.parse(questionsText);
                    setClarifyingQuestions(questions);
                    setStage('questions');
                } catch (error) {
                    console.error("Error generating questions:", error);
                    conductResearch();
                }
                setIsGeneratingQuestions(false);
            };

            const handleAnswerSubmit = () => {
                if (currentAnswer.trim()) {
                    setAnswers(prev => ({
                        ...prev,
                        [currentQuestionIndex]: currentAnswer
                    }));
                    setCurrentAnswer('');
                    
                    if (currentQuestionIndex < clarifyingQuestions.length - 1) {
                        setCurrentQuestionIndex(prev => prev + 1);
                    } else {
                        conductResearch();
                    }
                }
            };

            const conductResearch = async () => {
                setIsResearching(true);
                setStage('researching');

                try {
                    let subtopics = '';
                    if (Object.keys(answers).length > 0) {
                        subtopics = Object.entries(answers)
                            .map(([index, answer]) => `${clarifyingQuestions[index]}: ${answer}`)
                            .join('. ');
                    }

                    const finalPrompt = RESEARCH_PROMPT
                        .replace('[TOPIC]', topic)
                        .replace('[SUBTOPICS]', subtopics || 'general overview and key insights');

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 4000,
                            messages: [
                                {
                                    role: "user",
                                    content: finalPrompt
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    const reportContent = data.content[0].text;
                    
                    setReport(reportContent);
                    setStage('report');
                } catch (error) {
                    console.error("Error conducting research:", error);
                    setReport("Sorry, there was an error conducting the research. Please try again.");
                    setStage('report');
                }
                
                setIsResearching(false);
            };

            const startAudio = () => {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(report);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    utterance.onstart = () => {
                        setIsPlaying(true);
                        setIsPaused(false);
                        setStage('audio');
                    };
                    
                    utterance.onend = () => {
                        setIsPlaying(false);
                        setIsPaused(false);
                    };
                    
                    utterance.onerror = (event) => {
                        console.error('Speech synthesis error:', event);
                        setIsPlaying(false);
                        setIsPaused(false);
                    };
                    
                    speechSynthRef.current = utterance;
                    speechSynthesis.speak(utterance);
                }
            };

            const pauseAudio = () => {
                if (speechSynthesis.speaking && !speechSynthesis.paused) {
                    speechSynthesis.pause();
                    setIsPaused(true);
                }
            };

            const resumeAudio = () => {
                if (speechSynthesis.paused) {
                    speechSynthesis.resume();
                    setIsPaused(false);
                }
            };

            const stopAudio = () => {
                speechSynthesis.cancel();
                setIsPlaying(false);
                setIsPaused(false);
                setStage('report');
            };

            const resetApp = () => {
                speechSynthesis.cancel();
                setTopic('');
                setClarifyingQuestions([]);
                setAnswers({});
                setCurrentAnswer('');
                setCurrentQuestionIndex(0);
                setReport('');
                setIsResearching(false);
                setIsGeneratingQuestions(false);
                setStage('input');
                setIsPlaying(false);
                setIsPaused(false);
            };

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-b-lg' },
                    React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                        React.createElement(BookOpen, { size: 28 }),
                        React.createElement('h1', { className: 'text-xl font-bold' }, 'Learning Podcast')
                    ),
                    React.createElement('p', { className: 'text-blue-100 text-sm' }, 'Research any topic, listen on the go')
                ),

                React.createElement('div', { className: 'p-6' },
                    stage === 'input' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-gray-700 font-medium mb-3' },
                                'What would you like to learn about?'
                            ),
                            React.createElement('textarea', {
                                value: topic,
                                onChange: (e) => setTopic(e.target.value),
                                placeholder: 'Enter any topic that comes to mind...',
                                className: 'w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none',
                                rows: 3
                            })
                        ),
                        
                        React.createElement('button', {
                            onClick: generateClarifyingQuestions,
                            disabled: !topic.trim() || isGeneratingQuestions,
                            className: 'w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2'
                        },
                            isGeneratingQuestions ? [
                                React.createElement(Loader, { className: 'animate-spin', size: 20, key: 'loader' }),
                                'Preparing Questions...'
                            ] : [
                                React.createElement(MessageSquare, { size: 20, key: 'icon' }),
                                'Start Research'
                            ]
                        )
                    ),

                    stage === 'questions' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg' },
                            React.createElement('p', { className: 'text-blue-800 font-medium mb-2' },
                                `Question ${currentQuestionIndex + 1} of ${clarifyingQuestions.length}`
                            ),
                            React.createElement('p', { className: 'text-gray-700' }, clarifyingQuestions[currentQuestionIndex])
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('textarea', {
                                value: currentAnswer,
                                onChange: (e) => setCurrentAnswer(e.target.value),
                                placeholder: 'Your answer...',
                                className: 'w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none',
                                rows: 3
                            })
                        ),
                        
                        React.createElement('button', {
                            onClick: handleAnswerSubmit,
                            disabled: !currentAnswer.trim(),
                            className: 'w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2'
                        },
                            React.createElement(Send, { size: 20 }),
                            currentQuestionIndex < clarifyingQuestions.length - 1 ? 'Next Question' : 'Start Research'
                        )
                    ),

                    stage === 'researching' && React.createElement('div', { className: 'text-center space-y-6 py-12' },
                        React.createElement('div', { className: 'flex justify-center' },
                            React.createElement(Loader, { className: 'animate-spin text-blue-600', size: 48 })
                        ),
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'text-lg font-medium text-gray-800 mb-2' }, 'Researching your topic'),
                            React.createElement('p', { className: 'text-gray-600' }, 'Gathering insights and creating your personalized report...')
                        )
                    ),

                    (stage === 'report' || stage === 'audio') && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'flex items-center justify-between' },
                            React.createElement('h3', { className: 'text-lg font-bold text-gray-800' }, 'Research Complete'),
                            React.createElement('button', {
                                onClick: resetApp,
                                className: 'text-blue-600 text-sm font-medium hover:text-blue-700'
                            }, 'New Topic')
                        ),
                        
                        React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg' },
                            React.createElement('div', { className: 'flex items-center justify-center gap-4' },
                                !isPlaying ? React.createElement('button', {
                                    onClick: startAudio,
                                    className: 'bg-green-600 text-white p-3 rounded-full hover:bg-green-700 flex items-center gap-2'
                                },
                                    React.createElement(Play, { size: 24, fill: 'currentColor' })
                                ) : [
                                    !isPaused ? React.createElement('button', {
                                        onClick: pauseAudio,
                                        className: 'bg-yellow-600 text-white p-3 rounded-full hover:bg-yellow-700',
                                        key: 'pause'
                                    },
                                        React.createElement(Pause, { size: 24 })
                                    ) : React.createElement('button', {
                                        onClick: resumeAudio,
                                        className: 'bg-green-600 text-white p-3 rounded-full hover:bg-green-700',
                                        key: 'resume'
                                    },
                                        React.createElement(Play, { size: 24, fill: 'currentColor' })
                                    ),
                                    React.createElement('button', {
                                        onClick: stopAudio,
                                        className: 'bg-red-600 text-white p-3 rounded-full hover:bg-red-700',
                                        key: 'stop'
                                    },
                                        React.createElement(Square, { size: 24 })
                                    )
                                ]
                            ),
                            
                            React.createElement('div', { className: 'text-center mt-3' },
                                isPlaying ? React.createElement('div', { className: 'flex items-center justify-center gap-2 text-sm text-gray-600' },
                                    React.createElement(Headphones, { size: 16 }),
                                    isPaused ? 'Paused' : 'Playing podcast...'
                                ) : React.createElement('p', { className: 'text-sm text-gray-600' }, 'Ready to listen')
                            )
                        ),
                        
                        React.createElement('div', { className: 'border border-gray-200 rounded-lg overflow-hidden' },
                            React.createElement('div', { className: 'bg-gray-50 p-3 border-b border-gray-200' },
                                React.createElement('h4', { className: 'font-medium text-gray-700' }, 'Research Report')
                            ),
                            React.createElement('div', { className: 'p-4 max-h-96 overflow-y-auto' },
                                React.createElement('div', { 
                                    className: 'prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap',
                                    style: { whiteSpace: 'pre-wrap' }
                                }, report)
                            )
                        )
                    )
                )
            );
        };

        try {
            ReactDOM.render(React.createElement(PodcastLearningApp), document.getElementById('root'));
        } catch (err) {
            console.error('Error loading app:', err);
            document.getElementById('root').innerHTML = '<div class="error-message"><h2>Loading Error</h2><p>There was an error loading the app. Please refresh the page.</p><p>Error: ' + err.message + '</p></div>';
        }
    </script>
</body>
</html>
